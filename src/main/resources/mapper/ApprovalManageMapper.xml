<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dl.mapper.ApprovalManageMapper">

    <select id="queryLeaveApprovalPage" resultType="com.dl.entity.vo.LeaveApprovalVO">
        SELECT 
            la.id as approvalId,
            la.student_id as studentId,
            si.stu_name as studentName,
            la.reason as leaveReason,
            date_format(la.start_time, '%Y-%m-%d') as startTime,
            date_format(la.end_time, '%Y-%m-%d') as endTime,
            la.status,
            la.opinion as approvalOpinion,
            date_format(la.create_time, '%Y-%m-%d %H:%i:%s') as createTime
        FROM 
            leave_approval la
        LEFT JOIN 
            student_info si ON la.student_id = si.stu_id
        <where>
            <if test="studentId != null and studentId != ''">
                AND la.student_id LIKE CONCAT('%', #{studentId}, '%')
            </if>
            <if test="studentName != null and studentName != ''">
                AND si.stu_name LIKE CONCAT('%', #{studentName}, '%')
            </if>
            <if test="status != null and status != ''">
                AND la.status = #{status}
            </if>
        </where>
        ORDER BY la.create_time DESC
    </select>
</mapper>
